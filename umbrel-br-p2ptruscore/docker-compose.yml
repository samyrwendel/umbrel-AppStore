version: '3'

services:
  bot:
    image: node:20-alpine
    restart: unless-stopped
    
    command: >
      sh -c "
        echo 'P2P TrustScore Bot - Iniciando...' &&
        echo 'Clonando repositório...' &&
        apk add --no-cache git &&
        git clone https://github.com/samyrwendel/p2ptruscore.git /app &&
        cd /app &&
        echo 'Instalando dependências...' &&
        npm install &&
        echo 'Compilando...' &&
        npm run build &&
        echo 'Bot pronto! Iniciando...' &&
        npm run start:prod
      "
    
    volumes:
      - ${APP_DATA_DIR}/data:/data
    
    environment:
      NODE_ENV: production
      PORT: 3000
      MONGODB_CNN: mongodb://admin:umbrel@host.docker.internal:27017/p2ptrustscore?authSource=admin
    
    ports:
      - "${APP_HOST_PORT}:3000"